CREATE DATABASE elearning_db CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
USE elearning_db;

CREATE TABLE users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  email VARCHAR(100) NOT NULL UNIQUE,
  password VARCHAR(255) NOT NULL,
  role ENUM('siswa','guru') NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE materi (
  id INT AUTO_INCREMENT PRIMARY KEY,
  judul VARCHAR(255) NOT NULL,
  deskripsi TEXT,
  file_materi VARCHAR(255) DEFAULT NULL,
  created_by INT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE CASCADE
);

CREATE TABLE tugas (
  id INT AUTO_INCREMENT PRIMARY KEY,
  judul VARCHAR(255) NOT NULL,
  deskripsi TEXT,
  deadline DATE,
  created_by INT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE CASCADE
);

CREATE TABLE tugas_upload (
  id INT AUTO_INCREMENT PRIMARY KEY,
  tugas_id INT NOT NULL,
  siswa_id INT NOT NULL,
  file_tugas VARCHAR(255) NOT NULL,
  nilai INT DEFAULT NULL,
  feedback TEXT DEFAULT NULL,
  uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (tugas_id) REFERENCES tugas(id) ON DELETE CASCADE,
  FOREIGN KEY (siswa_id) REFERENCES users(id) ON DELETE CASCADE
);

CREATE TABLE kuis (
  id INT AUTO_INCREMENT PRIMARY KEY,
  judul VARCHAR(255) NOT NULL,
  created_by INT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE CASCADE
);

CREATE TABLE kuis_soal (
  id INT AUTO_INCREMENT PRIMARY KEY,
  kuis_id INT NOT NULL,
  pertanyaan TEXT NOT NULL,
  jawaban_a VARCHAR(255) NOT NULL,
  jawaban_b VARCHAR(255) NOT NULL,
  jawaban_c VARCHAR(255) NOT NULL,
  jawaban_d VARCHAR(255) NOT NULL,
  jawaban_benar ENUM('a','b','c','d') NOT NULL,
  FOREIGN KEY (kuis_id) REFERENCES kuis(id) ON DELETE CASCADE
);

CREATE TABLE kuis_hasil (
  id INT AUTO_INCREMENT PRIMARY KEY,
  kuis_id INT NOT NULL,
  siswa_id INT NOT NULL,
  nilai INT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (kuis_id) REFERENCES kuis(id) ON DELETE CASCADE,
  FOREIGN KEY (siswa_id) REFERENCES users(id) ON DELETE CASCADE
);
